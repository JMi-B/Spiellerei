[[2025-11-12]] <-> 

| Zeit  | Termin      |
| ----- | ----------- |
| 7:45  | Kommen      |
| 10:00 | DeepDive    |
| 13:00 | Joint Daily |
| 13:15 | Azubi-Daily |
| 16:45 | Gehen       |
- [ ] Python Programm um Daten aus der Swyxware auf meiner VM abzurufen
	- [x] Mssql Connector selbstständig installieren
	- [x] Mit der DB auf der VM verbinden - IP der VM
		- [x] Debuggen und dokumentieren
	- [ ] Sicherheitsprobleme lösen
		- [ ] Die Firewall ist aus
		- [ ] der sa Account ist zu mächtig
			- [ ] Neuen Account mit den benötigten Rechten erstellem
		- [ ] Das PW steht im Klartext im Script
			- [ ] deshalb schlägt die MS Lernplattform .env vor 
	- [ ] print 50 calls - Anrufer, Ziel, Start und Endzeitpunkt, Callid
		- [ ] last calls sind interessanter als top
# Fortsetzung : Abfrage MSSQL-Python
[[2025-11-12#Abfrage meiner der DB auf meiner VM mit Python]]
### connection
https://github.com/microsoft/mssql-python/wiki/Connection#connect-method
- Welche Liberys muss ich nach python importieren?
	- einfach machen
	- https://learn.microsoft.com/de-de/sql/connect/python/mssql-python/python-sql-driver-mssql-python-quickstart?view=sql-server-ver17&tabs=windows%2Cazure-sql#create-a-new-file
Port : 1433
##### Problem Behandlung
Wie ist das vorgehen bei der Fehlersuch?
###### Python Schritt für Schritt Fehlermeldung für Fehlermeldung
`RuntimeError: [Microsoft][ODBC Driver 18 for SQL Server]Neither DSN nor SERVER keyword supplied` 
- Tippfehler im `conn_str` (ConnectionString) behoben,
	- angefangen zu googlen
		- Das ist das Max dessen was ich alleine machen kann
	- ``conn_str`` darf keine Leerzeichen haben
		- `keyword` weißt darauf hin, dass ein `tuple` erwartet wird. Durch eine Leerzeichen nach dem `=` kann das Programm das Wert=Keyword-Paar nicht erkennen.
		- https://www.connectionstrings.com/sql-server/ 
		- Website die ConnectionStrings erstellt, gut um sie als Beispiele zur Orientierung zu nutzen
- Was bedeutet der Fehler?
	- Verbindung kommt nicht zustande
	-  Server=<servername> durch IP-Addresse ersetzt.
	-  `print` hinzu gefügt um klar zu haben, ob das Skript durchläuft
	- `SELECT` Query in `coursor.execute` damit das Skript auf der DB nicht ins leere läuft
###### Powershell auf meinem Rechner Schritt für Schritt
- Feststellen ob die Verbindung zustande kommt
	- ` test-netconnection 192.168.47.128 -p 1433`
![[Screenshot 2025-11-13 135722.png]]
- Ping und TCP fehl geschlagen

######  Einsetellungen auf dem WindowsServer anpassen
- Firewall verhindert den Ping
	- Firewall ausschalten **<<!Vorsicht! Sicherheitsrisiko>>**
	- ![[Screenshot 2025-11-13 140811 1.png]]
	- Im Windows Defender Tool prüfen ob es eine Regel für diesen Fall gibt.
		- Gibt es nicht also Firewall aus :-((
	- ![[Screenshot 2025-11-13 141019 1.png]]
	-  ` test-netconnection 192.168.47.128 -p 1433`
		- ``PingSucceeded : True
		- ``TcpTestSucceded: false
	- Was ist mit dem Port auf dem Windows SQL Server?
		- Da es immer noch nicht klappt prüfen mit cmd auf dem WindowsServer testen, ob der Port 1433 existiert
		- ![[Screenshot 2025-11-13 142846.png]]
		- Die Liste zeigt die Ports, die auf ``lisent`` stehen, das heißt auf Ansprache warten
	- Windows SQL Server
		- ![[Screenshot 2025-11-13 142205 1.png]]
		- TCP/IP anschalten
			- Mehrere Versuche
		- ![[Pasted image 20251113142508.png]]
			- Als erstes nur für die IPv4 den Port 1433 eingeschaltet
		- ![[Screenshot 2025-11-13 142353.png]]
			- Da ``Listen all`` muss es auch in dieser Einstellung geändert werden
		- Nach jeder Änderung den SQL Server neu starten
		- Mit ` test-netconnection 192.168.47.128 -p 1433` testen
		
		- ERgebnis in Powershell auf meinem Client:
		- ![[Screenshot 2025-11-13 143217.png]]
###### Zurück nach Python
- Zertifizierung
	-  Zertifikat wird nicht anerkannt
	- `RuntimeError: [Microsoft][ODBC Driver 18 for SQL Server]SSL Provider: Die Zertifikatkette wurde von einer nicht vertrauenswürdigen Zertifizierungsstelle ausgestellt.`
	- `trustservercertificate=yes``

- User Login
	- ``RuntimeError: [Microsoft][ODBC Driver 18 for SQL Server][SQL Server]Login failed. The login is from an untrusted domain and cannot be used with Integrated authentication.``
	- Der SQL Server erwartet Login Informationen statt der integrieten `Trusted_connection=yes`
	- UID=myUsername;PWD=myPassword;
	- Austausch des Codes
	- `` Server=192.168.47.128,1433;Database=IpPbx;Trusted_connection=yes;trustservercertificate=yes;`` 
	- durch
	- `` Server=192.168.47.128,1433;Database=IpPbx;UID=myUsername;PWD=myPassword;trustservercertificate=yes;``
	- Probleme mit dem Nutzer 'Admin'
	- Auf dem SQL Server suchen welcher User angelegt ist unter
	- Securety Login im SQL MangementStudio
	- ![[Screenshot 2025-11-13 162947.png]]
	- sa (SuperAdmin) funktioniert ist aber unsicher
	- 